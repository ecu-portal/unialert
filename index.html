<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniAlert - ECU</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --main-red: #c0392b;
            --white: #ffffff;
            --gray: #f4f4f4;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--gray);
            overflow-x: hidden;
        }

        /* Splash Screen */
        #welcomeScreen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.8s ease, visibility 0.8s;
        }

        #welcomeScreen img {
            width: 180px;
            margin-bottom: 20px;
        }

        .container {
            max-width: 450px;
            margin: 60px auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-top: 6px solid var(--main-red);
            text-align: center;
        }

        h1 { color: var(--main-red); font-size: 28px; }
        p { color: #666; }

        button {
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            background: var(--main-red);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover { background: #a93226; transform: translateY(-2px); }

        input, select {
            width: 90%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
        }

        .hidden { display: none !important; }

        .notif-bar {
            background: #fff0f0;
            border-left: 5px solid var(--main-red);
            padding: 15px;
            margin: 15px 0;
            font-weight: bold;
            color: var(--main-red);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            border: 1px solid #eee;
            text-align: left;
        }

        th { background: var(--main-red); color: white; }

        #adminPanel {
            margin-top: 20px;
            padding: 15px;
            border-top: 2px dashed #ccc;
            background: #f9f9f9;
            border-radius: 8px;
        }
    </style>
</head>
<body>

<div id="welcomeScreen">
    <img src="logo.png" id="mainLogo" alt="University Logo">
    <h2 style="color: var(--main-red);">Welcome to ECU Portal</h2>
    <p>Connecting to Firebase Realtime Database...</p>
</div>

<div class="container hidden" id="collegePage">
    <h1>Our Colleges</h1>
    <p>Select your faculty</p>
    <button onclick="goToLogin('Veterinary Medicine')">Veterinary Medicine</button>
    <button onclick="goToLogin('Computers and Information Systems')">Computers & IT</button>
    <button onclick="goToLogin('Arts and Design')">Fine Arts</button>
    <button onclick="goToLogin('Mass Communication')">Mass Communication</button>
</div>

<div class="container hidden" id="loginPage">
    <h2 id="facultyTitle">Login</h2>
    <input type="email" id="emailInput" placeholder="name@ecu.edu.eg">
    <input type="password" placeholder="Password">
    <button onclick="handleLogin()">Sign In</button>
    <p style="font-size: 12px;">Use any email starting with 'ta' for Admin Access</p>
</div>

<div class="container hidden" id="dashboard">
    <h1 id="dashboardTitle">Academic Schedule</h1>
    <div id="alertBox" class="notif-bar">Status: No updates for today.</div>
    <table>
        <thead>
            <tr>
                <th>Course</th>
                <th>Time</th>
            </tr>
        </thead>
        <tbody id="schedule">
            </tbody>
    </table>

    <div id="adminPanel" class="hidden">
        <h3 style="color: #333;">TA Control Panel</h3>
        <p style="font-size: 13px;">Select subject to update:</p>
        
        <select id="subjectSelect">
            <option value="biologyTime">Course 1: General Biology</option>
            <option value="writingTime">Course 2: Academic Writing</option>
        </select>

        <input type="text" id="newTimeInput" placeholder="Enter new time (Ex: 10:30 AM)">
        <button style="background: #2c3e50;" onclick="updateScheduleOnFirebase()">Push Update to All</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDx8U4_pYqLAKtdV5jCBqFk9sOKb9Jq_RQ",
        authDomain: "unialert-6e165.firebaseapp.com",
        projectId: "unialert-6e165",
        storageBucket: "unialert-6e165.firebasestorage.app",
        messagingSenderId: "771160764482",
        appId: "1:771160764482:web:30796a4cf47579e9b33ddb",
        measurementId: "G-MVNJS6DJWK"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    window.onload = () => {
        setTimeout(() => {
            const screen = document.getElementById('welcomeScreen');
            screen.style.opacity = '0';
            setTimeout(() => {
                screen.style.visibility = 'hidden';
                // الدخول مباشرة لصفحة الكليات
                document.getElementById('collegePage').classList.remove('hidden');
            }, 800);
        }, 3000);
    };

    let userFaculty = "";

    function goToLogin(faculty) {
        userFaculty = faculty;
        document.getElementById('collegePage').classList.add('hidden');
        document.getElementById('loginPage').classList.remove('hidden');
        document.getElementById('facultyTitle').innerText = faculty;
    }

    function handleLogin() {
        const email = document.getElementById('emailInput').value.toLowerCase();
        
        if(email.endsWith("@ecu.edu.eg")) {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');

            if(email.startsWith("ta") || email.startsWith("admin")) {
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('dashboardTitle').innerText = "TA Dashboard";
            }

            startRealtimeListener();
        } else {
            alert("Error: Please use your official @ecu.edu.eg email.");
        }
    }

    function startRealtimeListener() {
        const scheduleRef = database.ref('ecu_data/schedule');
        
        scheduleRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if(data) {
                renderSchedule(data);
                const alertBox = document.getElementById('alertBox');
                alertBox.innerText = "⚠️ Schedule was updated by faculty!";
                alertBox.style.background = "#c0392b";
                alertBox.style.color = "white";
            }
        });
    }

    function renderSchedule(data) {
        const tbody = document.getElementById('schedule');
        tbody.innerHTML = `
            <tr><td>General Biology</td><td>${data.biologyTime || "09:00 AM"}</td></tr>
            <tr><td>Academic Writing</td><td>${data.writingTime || "11:30 AM"}</td></tr>
            <tr><td>Intro to Faculty</td><td>02:00 PM</td></tr>
        `;
    }

    function updateScheduleOnFirebase() {
        const selectedKey = document.getElementById('subjectSelect').value; // جلب اسم الخانة المختارة
        const newTime = document.getElementById('newTimeInput').value;
        
        if(newTime === "") return alert("Please enter the new time.");

        // التحديث بناءً على المادة المختارة من الـ Select
        let updates = {};
        updates[selectedKey] = newTime;

        database.ref('ecu_data/schedule').update(updates).then(() => {
            alert("Update successful! Database updated for " + selectedKey);
            document.getElementById('newTimeInput').value = "";
        }).catch((error) => {
            alert("Error: " + error.message);
        });
    }
</script>

</body>
</html>
